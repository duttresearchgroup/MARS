<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Application Heartbeats: application.c</title>
<img src="img/hb.png" height="100" border="0" alt="Hearbeats"></a>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="classes.html"><span>Data&nbsp;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>application.c</h1>Basic Application Example<p>
<div class="fragment"><pre class="fragment">
<span class="preprocessor">#include &lt;stdio.h&gt;</span>
<span class="preprocessor">#include &lt;stdlib.h&gt;</span>
<span class="preprocessor">#include &lt;string.h&gt;</span>
<span class="preprocessor">#include &lt;unistd.h&gt;</span>
<span class="preprocessor">#include "<a class="code" href="heartbeat_8h.html">heartbeat.h</a>"</span>

<a name="_a0"></a><a class="code" href="structheartbeat__t.html">heartbeat_t</a> <a name="a1"></a><a class="code" href="application_8c.html#6f3bbe24b9b561560ce8bf9208aeb8a7">heart</a>;


<span class="keywordtype">int</span> <a name="a2"></a><a class="code" href="application_8c.html#3c04138a5bfe5d72780bb7e82a18e627" title="compile with define NOSLEEP for none">main</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv) {

   <span class="keywordflow">if</span> ( argc != 5 )
   {
      printf(<span class="stringliteral">"usage:\n"</span>);
      printf(<span class="stringliteral">"  application num_beats, log_file, sleep_interval, buffer_depth\n"</span>);
      <span class="keywordflow">return</span> -1;
   }
   <span class="keywordflow">if</span>(getenv(<span class="stringliteral">"HEARTBEAT_ENABLED_DIR"</span>) == NULL) {
     fprintf(stderr, <span class="stringliteral">"ERROR: need to define environment variable HEARTBEAT_ENABLED_DIR (see README)\n"</span>);
     <span class="keywordflow">return</span> 1;
   }

   <span class="keywordtype">int</span> i;
   <span class="keywordtype">int</span> sleep = atoi(argv[3]);
   <span class="keyword">const</span> <span class="keywordtype">int</span> MAX = atoi(argv[1]);
   <span class="keyword">const</span> <span class="keywordtype">int</span> BD = atoi(argv[4]);
   <span class="keywordtype">int</span> rc;

   printf(<span class="stringliteral">"Init\n"</span>);
   rc = <a name="a3"></a><a class="code" href="heartbeat-file_8c.html#b0215f451a25327778cf2469bbf17808">heartbeat_init</a>(&amp;heart, 0, 1000000, 100, BD, NULL);

   <span class="keywordflow">if</span>(rc != 0)
     printf(<span class="stringliteral">"Error allocating heartbeat data %d\n"</span>, rc);

   printf(<span class="stringliteral">"Sleep\n"</span>);
   usleep(3000000);

   printf(<span class="stringliteral">"Heartbeats\n"</span>);
   <span class="keywordflow">for</span>(i = 0; i &lt; MAX; i++) {
     <span class="comment">//printf("Heartbeat %d\n", i);</span>
      <a name="a4"></a><a class="code" href="heartbeat-file_8c.html#83cee6dbfb8365b1595ef200f45fe6fc">heartbeat</a>(&amp;heart, i);
     usleep(sleep);
   }
   printf(<span class="stringliteral">"Heartbeats Done\n"</span>);
      usleep(sleep);
      usleep(sleep);

   printf(<span class="stringliteral">"Global heart rate: %f, Current heart rate: %f\n"</span>,
          <a name="a5"></a><a class="code" href="heartbeat-file_8c.html#55b60b6aa61bbb71ee099f2e7180540e">hb_get_global_rate</a>(&amp;heart), <a name="a6"></a><a class="code" href="heartbeat-file_8c.html#7afb09ea470be506247e69e874127be3">hb_get_windowed_rate</a>(&amp;heart));

   <a name="a7"></a><a class="code" href="heartbeat-file_8c.html#472683cf2037492695c74b37944efca9">heartbeat_finish</a>(&amp;heart);
   <span class="keywordflow">return</span> 0;
}
</pre></div> </div>
<hr size="1"><address style="text-align: right;"><small>Generated on Wed Feb 10 12:43:50 2010 for Application Heartbeats by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
